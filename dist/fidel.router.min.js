/*!
 * fidel-router - Router for Fidel
 * v0.2.0
 * https://github.com/jgallen23/fidel-router
 * copyright Greg Allen 2013
 * MIT License
*/
(function(t){var e=[],n={},r="routie",o=t[r],i=function(t,e){this.name=e,this.path=t,this.keys=[],this.fns=[],this.params={},this.regex=s(this.path,this.keys,!1,!1)};i.prototype.addHandler=function(t){this.fns.push(t);var e=u();f(e,this)},i.prototype.removeHandler=function(t){for(var e=0,n=this.fns.length;n>e;e++){var r=this.fns[e];if(t==r)return this.fns.splice(e,1),void 0}},i.prototype.run=function(t){for(var e=0,n=this.fns.length;n>e;e++)this.fns[e].apply(this,t)},i.prototype.match=function(t,e){var n=this.regex.exec(t);if(!n)return!1;for(var r=1,o=n.length;o>r;++r){var i=this.keys[r-1],s="string"==typeof n[r]?decodeURIComponent(n[r]):n[r];i&&(this.params[i.name]=s),e.push(s)}return!0},i.prototype.toURL=function(t){var e=this.path;for(var n in t)e=e.replace("/:"+n,"/"+t[n]);if(e=e.replace(/\/:.*\?/g,"/").replace(/\?/g,""),-1!=e.indexOf(":"))throw Error("missing parameters for url: "+e);return e};var s=function(t,e,n,r){return t instanceof RegExp?t:(t instanceof Array&&(t="("+t.join("|")+")"),t=t.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(t,n,r,o,i,s){return e.push({name:o,optional:!!s}),n=n||"",""+(s?"":n)+"(?:"+(s?n:"")+(r||"")+(i||r&&"([^/.]+?)"||"([^/]+?)")+")"+(s||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),RegExp("^"+t+"$",n?"":"i"))},a=function(t,r){var o=t.split(" "),s=2==o.length?o[0]:null;t=2==o.length?o[1]:o[0],n[t]||(n[t]=new i(t,s),e.push(n[t])),n[t].addHandler(r)},h=function(t,e){if("function"==typeof e)a(t,e);else if("object"==typeof t)for(var n in t)a(n,t[n]);else e===void 0&&h.navigate(t)};h.lookup=function(t,n){for(var r=0,o=e.length;o>r;r++){var i=e[r];if(i.name==t)return i.toURL(n)}},h.remove=function(t,e){var r=n[t];r&&r.removeHandler(e)},h.removeAll=function(){n={},e=[]},h.navigate=function(t,e){e=e||{};var n=e.silent||!1;n&&l(),setTimeout(function(){window.location.hash=t,n&&setTimeout(function(){p()},1)},1)},h.noConflict=function(){return t[r]=o,h};var u=function(){return window.location.hash.substring(1)},f=function(t,e){var n=[];return e.match(t,n)?(e.run(n),!0):!1},c=h.reload=function(){for(var t=u(),n=0,r=e.length;r>n;n++){var o=e[n];if(f(t,o))return}},p=function(){t.addEventListener?t.addEventListener("hashchange",c,!1):t.attachEvent("onhashchange",c)},l=function(){t.removeEventListener?t.removeEventListener("hashchange",c):t.detachEvent("onhashchange",c)};p(),t[r]=h})(window),Fidel.prototype.router=routie.noConflict(),Fidel.prototype.processRoutes=function(){this._routesFns=[];for(var t in this.routes){var e=this.routes[t],n=this.proxy(this[e]);this._routesFns.push({path:t,fn:n}),this.router(t,n)}},Fidel.prototype.removeRoutes=function(){for(var t=0,e=this._routesFns.length;e>t;t++){var n=this._routesFns[t];this.router.remove(n.path,n.fn)}this._routesFns=[]},Fidel.prototype.route=function(t){this.router(t)},Fidel.onPostInit(function(){if(this.routes){this.processRoutes();var t=this;this.on("destroy",function(){t.removeRoutes()})}});